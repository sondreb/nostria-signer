<div class="container">
  @if (hasKeys()) {
  <div class="card">
    <h1 class="text-center">Nostria Signer</h1>

    <div class="tabs">
      <button class="tab" [class.active]="activeTab() === 'clients'" (click)="setActiveTab('clients')">
        Client Identities
      </button>
      <button class="tab" [class.active]="activeTab() === 'signer'" (click)="setActiveTab('signer')">
        Signer Identity
      </button>
      <button class="tab" [class.active]="activeTab() === 'relays'" (click)="setActiveTab('relays')">
        Relays
      </button>
    </div>

    @if (activeTab() === 'clients') {
    @for (key of keys(); track key.publicKey) {
    <div class="key-card">
      <div class="mb-3">
        <h3>Nostr Public Key:</h3>
        <div class="copy-container">
          <span class="copy-text">{{ key.publicKey }}</span>
          <button class="copy-button" (click)="copyToClipboard(key.publicKey)">Copy</button>
        </div>
      </div>

      <div class="mb-3">
        <h3>Nostr Private Key:</h3>
        <div class="copy-container">
          @if (isPrivateKeyVisible(key.publicKey)) {
          <span class="copy-text">{{ key.privateKey }}</span>
          } @else {
          <span class="copy-text masked-key">••••••••••••••••••••••••••••••••••••••••••••••••••••••••</span>
          }
          <button class="reveal-button" (click)="togglePrivateKeyVisibility(key.publicKey)">
            {{ isPrivateKeyVisible(key.publicKey) ? 'Hide' : 'Reveal' }}
          </button>
          <button class="copy-button" (click)="copyToClipboard(key.privateKey)">Copy</button>
        </div>
      </div>

      <div class="mb-3">
        <h3>Connection URL</h3>
        <p>Copy this URL to your Nostr client that supports Nostr Connect (NIP-46):</p>

        <div class="copy-container">
          <span class="copy-text">{{ getConnectionUrl(key) }}</span>
          <button class="copy-button" (click)="copyConnectionUrl(key)">Copy</button>
        </div>
      </div>

      <div class="text-right">
        <button class="danger" (click)="deleteKey(key.publicKey)">Delete</button>
      </div>
      <hr class="key-divider">
    </div>
    }
    }

    @if (activeTab() === 'signer') {
    @if (account()) {
    <div class="key-card">
      <div class="mb-3">
        <h3>Signer Public Key:</h3>
        <div class="copy-container">
          <span class="copy-text">{{ account()?.publicKey }}</span>
          <button class="copy-button" (click)="copyToClipboard(account()?.publicKey || '')">Copy</button>
        </div>
      </div>

      <div class="mb-3">
        <h3>Signer Private Key:</h3>
        <div class="copy-container">
          @if (isPrivateKeyVisible('signer')) {
          <span class="copy-text">{{ account()?.privateKey }}</span>
          } @else {
          <span class="copy-text masked-key">••••••••••••••••••••••••••••••••••••••••••••••••••••••••</span>
          }
          <button class="reveal-button" (click)="togglePrivateKeyVisibility('signer')">
            {{ isPrivateKeyVisible('signer') ? 'Hide' : 'Reveal' }}
          </button>
          <button class="copy-button" (click)="copyToClipboard(account()?.privateKey || '')">Copy</button>
        </div>
      </div>

      <div class="mb-3">
        <p class="signer-info">
          This is your signer identity that will be used to identity the remote signer.
        </p>
      </div>
    </div>
    } @else {
    <div class="key-card text-center">
      <p>No signer identity available. Generate a client identity first.</p>
    </div>
    }
    }

    @if (activeTab() === 'relays') {
    <div class="key-card">
      <h3>Manage Relays</h3>
      <p>Add or remove relays to connect your signer to the Nostr network</p>
      
      <div class="relay-list">
        @for (relay of relays(); track relay) {
        <div class="relay-item">
          <span>{{ relay }}</span>
          <button class="remove-button" (click)="removeRelay(relay)">Remove</button>
        </div>
        }
        
        @if (relays().length === 0) {
        <p class="text-center">No relays configured. Add at least one relay below.</p>
        }
      </div>
      
      <div class="add-relay-form">
        <input 
          type="text" 
          placeholder="wss://relay.example.com" 
          [ngModel]="newRelay()" 
          (ngModelChange)="newRelay.set($event)"
          class="relay-input" />
        <button 
          class="add-button" 
          [disabled]="!isValidUrl(newRelay())" 
          (click)="addRelay()">Add Relay</button>
      </div>
      
      <div class="relay-info">
        <p>
          <strong>Note:</strong> Relays should start with "wss://" for secure WebSocket connections.
          Changes to relays will affect all your connections.
        </p>
      </div>
    </div>
    }

    @if (activeTab() === 'clients') {
    <div class="instructions">
      <h3>How to connect:</h3>
      <ol>
        <li>Copy the Connection URL of your desired key</li>
        <li>Open your Nostr client that supports NIP-46</li>
        <li>Look for "Connect with external signer" or similar option</li>
        <li>Paste the URL and approve the connection</li>
      </ol>
    </div>
    }

    <div class="actions mt-4">
      <button class="primary" (click)="generateNewKey()">Generate New Client Identity</button>
      <button class="secondary" (click)="resetAllKeys()">Reset All Keys</button>
    </div>
  </div>
  } @else {
  <div class="card text-center">
    <p>No keys available. Generating...</p>
    <button class="primary" (click)="generateNewKey()">Generate New Client Identity</button>
  </div>
  }
</div>